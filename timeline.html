<!DOCTYPE html>
<html lang="en">
<head>
  <title>Document Archive & Timeline</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="1760bylaws.css">
  <link rel="stylesheet" href="1760BSaddin.css">
  <link rel="stylesheet" href="viewport.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <style>
    body { padding-top:0; margin-top:0; }
    img { max-width:100%; height:auto; }
    .thumb { max-width: 96%; border:1px solid #fff; border-radius:2px; box-shadow:0 0 4px #999; padding:4px; margin:6px; }
    .sortable { cursor:pointer; }
    .muted { color:#777; }
    .tag { display:inline-block; padding:2px 6px; border:1px solid #ddd; border-radius:10px; margin-right:6px; font-size:12px; }
  </style>
</head>

<body>
<div class="container">
  <div class="well">
    <h1>The Paper Trail</h1>
    <h3>Public postings by Margaret McNulty,<br>1760 Tenant Association President</h3>
  </div>

  <div class="well">
    <div class="row" style="margin-bottom:12px;">
      <div class="col-sm-6">
        <input id="searchBox" class="form-control" placeholder="Search title/description/tags…">
      </div>
      <div class="col-sm-6 text-right muted" id="countBox"></div>
    </div>

    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th class="sortable" data-sort="date">Date</th>
          <th class="sortable" data-sort="title">Title/Webpage</th>
          <th>Description</th>
          <th>File</th>
        </tr>
      </thead>
      <tbody id="timelineBody"></tbody>
    </table>
  </div>

  <div class="well" style="text-align:center; background:#999; color:#fff; margin-top:40px; margin-bottom:0;">
    <div class="container" style="text-align:center; margin-top:-30px;">
      <p><a href="index.html"><button type="button" class="btn btn-info" style="box-shadow: 0 0 6px;">HOME</button></a></p>
    </div>
    <div class="container" style="text-align:center">
      <p><br><a href="mailto:wethepeopleof1760@gmail.com" style="color:white;">wethepeopleof1760@gmail.com</a></p>
    </div>
  </div>
</div>

<script src="./timeline-data.js"></script>
<script>
  let sortKey = "date";
  let sortDir = "desc"; // newest first

  function safeLink(url, text){
    if(!url) return $("<span>").text(text || "");
    return $("<a>").attr("href", url).attr("target","_blank").text(text || url);
  }

  function render(items){
    const $body = $("#timelineBody").empty();

    items.forEach(item => {
      const $tr = $("<tr>");

      // Date
      $tr.append($("<td>").text(item.dateDisplay || ""));

      // Title
      const $titleCell = $("<td>");
      $titleCell.append(safeLink(item.pageUrl || item.fileUrl, item.title || ""));
      if(item.tags && item.tags.length){
        $titleCell.append($("<div>").css("margin-top","6px")
          .append(item.tags.map(t => $("<span class='tag'>").text(t)))
        );
      }
      $tr.append($titleCell);

      // Description
      $tr.append($("<td>").text(item.description || ""));

      // File thumb/link
      const $fileCell = $("<td>");
      if(item.thumbUrl){
        const $img = $("<img>").addClass("thumb").attr("src", item.thumbUrl).attr("alt", item.title || "");
        if(item.fileUrl){
          $fileCell.append($("<a>").attr("href", item.fileUrl).attr("target","_blank").append($img));
        } else {
          $fileCell.append($img);
        }
      } else if(item.fileUrl){
        $fileCell.append(safeLink(item.fileUrl, "Open"));
      } else {
        $fileCell.append($("<span>").addClass("muted").text("—"));
      }
      $tr.append($fileCell);

      $body.append($tr);
    });

    $("#countBox").text(items.length + " items");
  }

  function applySort(items){
    const sorted = items.slice().sort((a,b) => {
      if(sortKey === "title"){
        const A = (a.title || "").toLowerCase();
        const B = (b.title || "").toLowerCase();
        return A.localeCompare(B);
      }
      // date
      const A = a.dateISO || "";
      const B = b.dateISO || "";
      return A.localeCompare(B);
    });
    if(sortDir === "desc") sorted.reverse();
    return sorted;
  }

  function applySearch(items, q){
    if(!q) return items;
    q = q.toLowerCase();
    return items.filter(it => {
      const blob = [
        it.dateDisplay, it.dateISO, it.title, it.description,
        (it.tags || []).join(" ")
      ].join(" ").toLowerCase();
      return blob.includes(q);
    });
  }

  function refresh(){
    const q = $("#searchBox").val() || "";
    const filtered = applySearch(TIMELINE_ITEMS, q);
    const sorted = applySort(filtered);
    render(sorted);
  }

  // click headers to sort
  $(document).on("click", "th.sortable", function(){
    const key = $(this).data("sort");
    if(sortKey === key){
      sortDir = (sortDir === "asc") ? "desc" : "asc";
    } else {
      sortKey = key;
      sortDir = (key === "date") ? "desc" : "asc";
    }
    refresh();
  });

  $("#searchBox").on("input", refresh);
  refresh();
</script>
</body>
</html>
